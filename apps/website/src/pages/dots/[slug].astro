---
import Layout from '../../layouts/DotPostLayout.astro';
import { DotPost } from '@eco/dots';

export function getStaticPaths({ rss }) {
  const posts = Astro.fetchContent('./data/*.md')
    .sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf())
    .map((post) => ({
      ...post,
      slug: post.file.pathname.split('/').pop().split('.').shift(),
    }));

  rss({
    title: `Eloy's dots`,
    stylesheet: true,
    description:
      'My blog with personal recommendations about whatever I found interesting',
    items: posts.map((post) => ({
      title: post.title,
      description: post.description,
      link: `/dots/${post.slug}`,
      pubDate: post.date,
    })),
  });

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { Content, title, description, date, canonicalUrl } = Astro.props.post;

const originalUrl = !canonicalUrl?.startsWith(Astro.site.href)
  ? canonicalUrl
  : undefined;
---

<Layout {title} {description} {canonicalUrl} {originalUrl}>
  <DotPost {title} {date} {originalUrl}>
    <Content />
  </DotPost>
</Layout>
