---
import DotPost from '../../components/DotPost.astro';
import Layout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths({ rss }) {
  const posts = (await Astro.glob('./data/*.md'))
    .sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf())
    .map((post) => ({
      ...post,
      slug: post.file.split('/').pop().split('.').shift(),
    }));

  rss({
    title: `Eloy's dots`,
    stylesheet: true,
    description: 'My blog with personal recommendations about whatever I found interesting',
    items: posts.map((post) => ({
      title: post.frontmatter.title,
      description: post.frontmatter.description,
      link: `/dots/${post.slug}`,
      pubDate: post.frontmatter.date,
    })),
  });

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { Content, frontmatter } = Astro.props.post;

const originalUrl = !frontmatter.canonicalUrl?.startsWith(Astro.site.href) ? frontmatter.canonicalUrl : undefined;
---

<Layout {frontmatter.title} {frontmatter.description} {frontmatter.canonicalUrl} {originalUrl}>
  <DotPost {frontmatter.title} {frontmatter.date} {originalUrl}>
    <Content />
  </DotPost>
</Layout>
